<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Vote</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <h2>Cod Bixinta Musharaxiinta</h2>
  <div class="candidates">
    <div class="candidate" onclick="submitVote('Farmaajo')">
      <img src="images/farmaajo.jpg" alt="Farmaajo" />
      <p>Farmaajo</p>
    </div>
    <div class="candidate" onclick="submitVote('Hassan Sheikh')">
      <img src="images/hassan.jpg" alt="Hassan Sheikh" />
      <p>Hassan Sheikh</p>
    </div>
    <div class="candidate" onclick="submitVote('Roble')">
      <img src="images/roble.jpg" alt="Roble" />
      <p>Roble</p>
    </div>
    <div class="candidate" onclick="submitVote('Kheyre')">
      <img src="images/kheyre.jpg" alt="Kheyre" />
      <p>Kheyre</p>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "firebase/app";
    import { getDatabase, ref, push, set } from "firebase/database";
    import { firebaseConfig } from "./js/config.js";

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    window.submitVote = function(candidate) {
      const voterName = sessionStorage.getItem("voterName") || "Anonymous";

      const voteRef = push(ref(db, 'votes'));
      set(voteRef, {
        candidate: candidate,
        voter: voterName,
        timestamp: Date.now()
      }).then(() => {
        alert("Waad codaysay: " + candidate);
        window.location.href = "results.html";
      }).catch((error) => {
        console.error("Vote not submitted:", error);
        alert("Error occurred.");
      });
    }
  </script>
</body>
</html>
